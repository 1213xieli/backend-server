webpackJsonp([46],{"11H8":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("IHPB"),a=s.n(i),n=s("teIl"),c=s("pzWD"),d=s("UNpN"),u=s("w3CS"),o=s("y6zN"),r=s("wSez"),l={name:"feedRecord",mixins:[s("PnOK").a],components:{SubmitBtn:c.a,myHeader:n.a},data:function(){return{username:"",batchNumber:"",batchId:"",switchBatchNumPopup:!1,batchNumSlots:[{values:[{id:"",name:""}],textAlign:"center"}],feedDate:new Date,feedDateText:Object(o.a)(new Date,"yyyy-MM-dd"),getFeedList:[{feedName:"",consumeQty:"",feedId:""}],switchSelectFeedPopup:!1,currentFeedTypeIndex:0,feedTypeSlots:[{values:[{feedId:"",feedName:""}],textAlign:"center"}]}},created:function(){this._getBatchNumberList()},mounted:function(){},methods:{_getBatchNumberList:function(){var e=this;r.Indicator.open({text:"加载中...",spinnerType:"fading-circle"}),Object(d.d)().then(function(t){t.data?(e.batchNumSlots[0].values=t.data.map(function(e,t){return{name:e.name,id:e.id}}),e.batchNumber=e.batchNumSlots[0].values[0].name,e.batchId=e.batchNumSlots[0].values[0].id,e._getPigwashList(e.batchId)):r.Indicator.close()},function(){r.Indicator.close()})},_getPigwashList:function(e){var t=this;Object(d.h)(e).then(function(e){r.Indicator.close(),t.feedTypeSlots[0].values=e.data.map(function(e,t){return{feedName:e.feedName,feedId:e.feedId}}),t.getFeedList[t.currentFeedTypeIndex].feedName=t.feedTypeSlots[0].values[0].feedName,t.getFeedList[t.currentFeedTypeIndex].feedId=t.feedTypeSlots[0].values[0].feedId},function(){r.Indicator.close()})},selectBatchNum:function(){this.batchNumSlots[0].values[0].name?this.switchBatchNumPopup=!this.switchBatchNumPopup:this.$toast({message:"无可选批次，请核实业务场景！",duration:1e3})},handleBatchConfirm:function(){this.batchNumber=this.$refs.batchPicker.getValues()[0].name,this.batchId=this.$refs.batchPicker.getValues()[0].id,this._getPigwashList(this.batchId),this.switchBatchNumPopup=!1},selectFeedDate:function(){this.$refs.feedPicker.open()},feedDateConfirm:function(e){this.feedDateText=Object(o.a)(e,"yyyy-MM-dd")},addFeedType:function(){this.getFeedList.push({feedName:this.getFeedList[0].feedName,feedId:this.getFeedList[0].feedId,consumeQty:""})},delGetFeedItem:function(e){this.getFeedList.length>1&&(this.getFeedList=this.getFeedList.filter(function(t,s){return e!==s}))},handleFeedTypeConfirm:function(){this.getFeedList[this.currentFeedTypeIndex].feedName=this.$refs.feedTypePicker.getValues()[0].feedName,this.getFeedList[this.currentFeedTypeIndex].feedId=this.$refs.feedTypePicker.getValues()[0].feedId,this.switchSelectFeedPopup=!1},selectFeedType:function(e){this.currentFeedTypeIndex=e,this.switchSelectFeedPopup=!this.switchSelectFeedPopup},handlerLimit:function(e,t){this.getFeedList[e].consumeQty=Object(u.a)(t,1)},submitPageData:function(){var e=this,t=[{val:this.batchNumber,rule:["required"],getTipText:"批次号"}],s=this.getFeedList.map(function(e,t){return{val:e.consumeQty,rule:["required"],getTipText:"饲料包数"}});if(!Object(u.b)([].concat(t,a()(s))))return!1;if(!this.isDisabledSubmit){this.isDisabledSubmit=!0,this.submitBtnText="提交中...";var i={batchId:this.batchId,batchName:this.batchNumber,feedDate:this.feedDateText,feedList:this.getFeedList};Object(d.q)(i).then(function(t){e.$toast({message:"提交成功！",duration:1e3}),e.$router.push("/feedRecordList")}).catch(function(t){e.isDisabledSubmit=!1,e.submitBtnText="提交"})}}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"feedlist",staticStyle:{"max-width":"100%","box-sizing":"border-box"}},[i("myHeader",{attrs:{isBack:!0,backPath:"/business",title:"添加记录",subtitle:"记录",subtitlePath:"/feedRecordList"}}),e._v(" "),i("div",{staticClass:"mt4 list-block"},[i("mt-cell",{attrs:{title:"批次号："},nativeOn:{click:function(t){return e.selectBatchNum(t)}}},[e._v("\n      "+e._s(e.batchNumber)+"\n      "),i("span",{staticClass:"img"})]),e._v(" "),i("mt-cell",{attrs:{title:"饲喂日期："},nativeOn:{click:function(t){return e.selectFeedDate(t)}}},[i("span",{staticClass:"color-text"},[e._v("\n        "+e._s(e.feedDateText)+"\n      ")]),e._v(" "),i("span",{staticClass:"img"})]),e._v(" "),i("mt-cell",{attrs:{title:"饲料记录："}}),e._v(" "),e._l(e.getFeedList,function(t,a){return i("div",{key:a,staticClass:"detail-item"},[i("div",{staticClass:"select-detail"},[i("div",{staticClass:"del-icon",on:{click:function(t){return e.delGetFeedItem(a)}}},[i("img",{attrs:{src:s("Xmmv")}})]),e._v(" "),i("div",{staticClass:"left"},[i("span",{staticClass:"left-name"},[e._v("饲料品种：")]),e._v(" "),i("span",{on:{click:function(t){return e.selectFeedType(a)}}},[e._v(e._s(t.feedName))]),e._v(" "),i("span",{staticClass:"img",on:{click:function(t){return e.selectFeedType(a)}}})]),e._v(" "),i("div",{staticClass:"right"},[i("span",[e._v("包数：")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.consumeQty,expression:"item.consumeQty"}],attrs:{type:"text",placeholder:"请输入数量"},domProps:{value:t.consumeQty},on:{input:[function(s){s.target.composing||e.$set(t,"consumeQty",s.target.value)},function(t){return e.handlerLimit(a,t)}]}})])])])}),e._v(" "),i("div",{staticClass:"add-select",on:{click:e.addFeedType}},[i("span",{staticClass:"add-icon"},[e._v("+")]),e._v("新增\n    ")])],2),e._v(" "),i("SubmitBtn",{attrs:{btnText:e.submitBtnText,customStyle:e.myCustomStyle},nativeOn:{click:function(t){return e.submitPageData(t)}}}),e._v(" "),i("div",{staticClass:"my-prop"},[i("mt-popup",{attrs:{position:"bottom"},model:{value:e.switchBatchNumPopup,callback:function(t){e.switchBatchNumPopup=t},expression:"switchBatchNumPopup"}},[i("mt-picker",{ref:"batchPicker",attrs:{slots:e.batchNumSlots,"value-key":"name","show-toolbar":!0}},[i("span",{staticClass:"sure-btn",on:{click:e.handleBatchConfirm}},[e._v("确认")])])],1),e._v(" "),i("mt-popup",{attrs:{position:"bottom"},model:{value:e.switchSelectFeedPopup,callback:function(t){e.switchSelectFeedPopup=t},expression:"switchSelectFeedPopup"}},[i("mt-picker",{ref:"feedTypePicker",attrs:{slots:e.feedTypeSlots,"value-key":"feedName","show-toolbar":!0}},[i("span",{staticClass:"sure-btn",on:{click:e.handleFeedTypeConfirm}},[e._v("确认")])])],1)],1),e._v(" "),i("mt-datetime-picker",{ref:"feedPicker",attrs:{type:"date"},on:{confirm:e.feedDateConfirm},model:{value:e.feedDate,callback:function(t){e.feedDate=t},expression:"feedDate"}})],1)},staticRenderFns:[]};var m=s("C7Lr")(l,h,!1,function(e){s("pX+h")},"data-v-2f9bae32",null);t.default=m.exports},"pX+h":function(e,t){}});
//# sourceMappingURL=46.9c0efd9d7e040a5f5ce5.js.map
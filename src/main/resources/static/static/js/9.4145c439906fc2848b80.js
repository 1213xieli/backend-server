webpackJsonp([9],{"+ciL":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA0UlEQVRYR+2UWw0CQQxF73WABRyABByAA9YBUnAADsABEsABFnBQ0mQmmZDtPPqzIen8T+7p6YNY+HHhfARAGAgDYeB/DYjIBsAtXdIDyZfnqroMpPAHgFUK/QDYeSCGAWbCc+EuiCGASrgbohvACJ9S8qXo/5CJLgArnORVg0XkCMAF0QRohefKvRBVABHRKX8X0655U678d+0MiDVJbcvsawHorj+Ln2Z4xcS2tp49LdA+7wGcrMoNE2cAd5I6H+ZrAniu28ifAAgDYSAMhIEvvgdTIbfvgiIAAAAASUVORK5CYII="},DvE8:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o("4YfN"),i=o.n(s),a=o("teIl"),n=o("3cXf"),l=o.n(n),r=o("X1H5"),c=o.n(r),m=o("9rMa"),h=o("+MaT"),u=o("wSez"),d={name:"takePhotoItem",data:function(){return{photoList:[],currentPhotoInfo:{},serverId:[],cameraData:[],newPhotoList:[],isShow:!1,imgSrc:"",imgNum:0}},props:{itemInfo:{type:Object,default:function(){return{}}},currentIndex:{type:Number,default:0}},computed:i()({},Object(m.b)(["signature","allPhotoLists"])),created:function(){"true"==this.itemInfo.isNewFoto?this.cameraData=["camera"]:this.cameraData=["album","camera"],this.initWxConfig(),this.photoList=this.itemInfo.photoList,this.newPhotoList=this.itemInfo.photoList,console.log(this.newPhotoList,"photoList-item"),this.countNum(this.itemInfo.photoList)>0&&(this.imgNum=this.countNum(this.itemInfo.photoList))},watch:{newPhotoList:function(t,e){return this.photoList=this.itemInfo.photoList,this.itemInfo.photoList}},methods:{isTakePhoto:function(){this.itemInfo.photoList&&this.itemInfo.photoList.length>=1?this.goPhotoDetail(this.itemInfo.itemId,this.itemInfo.maxQty,this.itemInfo.minQty,this.itemInfo.isNewFoto,this.itemInfo.name,this.itemInfo.isTakePhoto):this.takePhoto()},countNum:function(t){return t?t.length:0},goPhotoDetail:function(t,e,o,s,i,a){this.$router.push({name:"TakePhotoList",params:{id:t,maxNum:e,minNum:o,rcordId:this.allPhotoLists.rcordId,isNewFoto:s,name:i,isTakePhoto:a}})},isFirst:function(t){return!t||0===t.length},initWxConfig:function(){c.a.config({debug:!1,appId:this.signature.appId,timestamp:this.signature.timestamp,nonceStr:this.signature.nonceStr,signature:this.signature.signature,jsApiList:["chooseImage","getNetworkType","uploadImage","previewImage"]})},uploadImg:function(){var t=this;c.a.uploadImage({localId:t.currentPhotoInfo.loadId.toString(),isShowProgressTips:1,success:function(e){var o=t.currentPhotoInfo;o.serviceId=e.serverId,t.currentPhotoInfo={},t.newPhotoList.push(i()({isDelete:!0},o)),t.serverId.push(e.serverId),t.$toast({message:"上传成功!",duration:2e3});var s=t.serverId.map(function(t){return{serverId:t,imgType:"jpg"}}),a=[{itemId:t.itemInfo.itemId,name:t.itemInfo.name,data:s,isNewFoto:t.itemInfo.isNewFoto,photoList:t.newPhotoList,serverId:t.serverId}];t.$nextTick(function(){t.imgSrc=t.newPhotoList[0].src,t.imgNum=1,t.isShow=!0}),console.log(a,"takephoto-item_photoList"),t.$store.commit("SET_PHOTOLIST",a)},fail:function(e){t.$toast("上传失败:"+l()(e)),t.currentPhotoInfo={}}})},getBase64ByLocalId:function(t){var e=this;c.a.getLocalImgData({localId:t.toString(),success:function(t){e.currentPhotoInfo.src=t.localData,e.uploadImg()}})},takePhoto:function(){var t=this;c.a.ready(function(){c.a.chooseImage({count:1,sizeType:["original","compressed"],sourceType:t.cameraData,success:function(e){var o=e.localIds;t.currentPhotoInfo.loadId=o,1===Object(h.a)()?(t.currentPhotoInfo.src=o,t.uploadImg()):2===Object(h.a)()&&t.getBase64ByLocalId(o)}})})}}},p={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"takePhotoList-item",on:{click:function(e){return t.isTakePhoto()}}},[0===t.itemInfo.photoList.length?o("div",{staticClass:"takePhotoBox"},[t.isShow?t._e():o("div",{staticClass:"takePhoto-image"}),t._v(" "),o("mt-swipe",{attrs:{auto:4e3}},[t.isShow?o("mt-swipe-item",[o("img",{staticClass:"takePicture",attrs:{src:t.imgSrc,alt:""}})]):t._e()],1)],1):o("div",{staticClass:"takePhotoBox"},[o("mt-swipe",{attrs:{auto:4e3}},t._l(t.newPhotoList,function(t,e){return o("mt-swipe-item",{key:e},[o("img",{staticClass:"takePicture",attrs:{src:t.src?t.src:t.img,alt:""}})])}),1)],1),t._v(" "),o("p",[t._v(t._s(t.itemInfo.name))]),t._v(" "),o("p",[t._v("("+t._s(t.imgNum)+"/"+t._s(t.itemInfo.minQty)+")")])])},staticRenderFns:[]};var f=o("C7Lr")(d,p,!1,function(t){o("Y8gv")},"data-v-5dd9494b",null).exports,v=o("+3Wu"),L={name:"AddGoOutDetail",components:{myHeader:a.a,takePhotoItem:f},data:function(){return{allPhotoList:{name:"",reason:"",startTimeText:"",endTimeText:"",approvalName:"",billStatusIndex:!0,approveStatusIndex:"",approveAdminName:"",serviceSite:[],cleanTypeId:"",stateStatus:1,rcordId:"",photoList:[]},submitBtnText:"提交",isSubmit:!1,colorList:["#FF6A69","#EE6836","#5EC97E"]}},beforeRouteEnter:function(t,e,o){o(function(t){"ClearRecord"===e.name&&(t.$store.commit("CLEAR_PHOTOLIST",[]),sessionStorage.setItem("photoList",[]),t.$store.commit("CLEAR_ALLPHOTOLIST",[]),sessionStorage.setItem("allPhotoLists",[]),t.ajaxData())})},created:function(){},computed:i()({},Object(m.b)(["photoList","allPhotoLists"])),updated:function(){},watch:{allPhotoList:function(t,e){console.log(t)}},mounted:function(){},methods:{updateData:function(t){},ajaxData:function(){this.allPhotoList.rcordId=Object(h.b)("rcordId").replace(/%3D/g,"=").trim(),this.getDetail(this.allPhotoList.rcordId),this.getStepDetail(!1),console.log(this.allPhotoList),this.$store.commit("SET_ALLPHOTOLIST",this.allPhotoList)},getDetail:function(t){var e=this;Object(v.b)({base64RcordId:t}).then(function(t){if(200===t.status)if(e.allPhotoList.name=t.data.custName,e.allPhotoList.reason=t.data.reason,e.allPhotoList.startTimeText=t.data.planOutDate,e.allPhotoList.endTimeText=t.data.planResultDate,e.allPhotoList.approveStatusIndex=t.data.approveStatusIndex?t.data.approveStatusIndex:29,e.allPhotoList.approveAdminName=t.data.approveAdminName?t.data.approveAdminName:"无",e.allPhotoList.approvalName=t.data.approvalAdminName,e.allPhotoList.billStatusIndex=t.data.billStatusIndex,t.data.steps)if(t.data.steps.length>0){var o=t.data.steps.map(function(t){return{name:t.name,show:!0,itemInfoList:t.item.map(function(t,o){return{itemId:t.itemId,name:t.name,maxQty:t.maxQty,minQty:t.minQty,isNewFoto:t.isNewFoto,isTakePhoto:1==e.allPhotoList.approveStatusIndex&&5!=e.allPhotoList.billStatusIndex,photoList:t.imgs.map(function(t){return{img:t.img,isDelete:!1}})}})}});e.allPhotoList.serviceSite=o,console.log(e.allPhotoList.serviceSite,"serviceSite");var s=[];t.data.steps.forEach(function(t,o){t.item.forEach(function(t,o){s.push({itemId:t.itemId,name:t.name,maxQty:t.maxQty,isNewFoto:t.isNewFoto,minQty:t.minQty,isDelete:!1,isTakePhoto:1==e.allPhotoList.approveStatusIndex&&5!=e.allPhotoList.billStatusIndex,photoList:t.imgs.map(function(t){return{isDelete:!1,img:t.img}})})})}),e.allPhotoList.photoList=s,e.$store.commit("SET_PHOTOLIST",s)}else 1==e.allPhotoList.approveStatusIndex&&e.getStepDetail(!0);else 1==e.allPhotoList.approveStatusIndex&&e.getStepDetail(!0)})},getStepDetail:function(t){var e=this,o=this;Object(v.c)().then(function(s){if(200===s.status&&(e.allPhotoList.cleanTypeId=s.data[0].id,t)){var i=s.data.map(function(t){return{id:t.id,itemInfoList:t.itemInfoList.map(function(t){return{isNewFoto:t.isNewFoto,itemId:t.itemId,maxQty:t.maxQty,minQty:t.minQty,isTakePhoto:!0,name:t.name}}),name:t.name,show:!0}});if(o.allPhotoList.photoList){for(var a=0;a<i.length;a++)for(var n=0;n<i[a].itemInfoList.length;n++)for(var l=0;l<o.photoList.length;l++)i[a].itemInfoList[n].itemId===o.allPhotoList.photoList[l].itemId&&(i[a].itemInfoList[n].photoList=o.allPhotoList.photoList[l].photoList,i[a].itemInfoList[n].serverId=o.allPhotoList.photoList[l].serverId,i[a].itemInfoList[n].isTakePhoto=1===o.allPhotoList.approveStatusIndex);o.allPhotoList.serviceSite=i,console.log(o.allPhotoList.serviceSite,"newServiceSite")}else o.allPhotoList.serviceSite=i}}).catch(function(t){})},cancel:function(){this.$router.push("/clearRecord")},togglePhotoItem:function(t){this.allPhotoList.serviceSite[t].show=!this.allPhotoList.serviceSite[t].show},goPhotoDetail:function(t,e,o,s,i,a){this.$router.push({name:"TakePhotoList",params:{id:t,maxNum:e,minNum:o,rcordId:this.allPhotoList.rcordId,isNewFoto:s,name:i,isTakePhoto:a}})},submit:function(t){if(t){for(var e=!0,o=0;o<this.allPhotoLists.serviceSite.length;o++)for(var s=this.allPhotoLists.serviceSite[o],i=0;i<this.allPhotoLists.serviceSite[o].itemInfoList.length;i++){var a=this.allPhotoLists.serviceSite[o].itemInfoList[i];if(!this.allPhotoLists.serviceSite[o].itemInfoList[i].photoList)return Object(u.Toast)(s.name+"的"+a.name+"照片最少"+a.minQty+"张，最多"+a.maxQty+"张"),e=!1,!1;if(a.photoList.length<a.minQty||a.photoList.length>a.maxQty)return Object(u.Toast)(s.name+"的"+a.name+"照片最少"+a.minQty+"张，最多"+a.maxQty+"张"),!1}e&&this.goPromise(t)}else this.goPromise(t)},goPromise:function(t){var e=this;if(t)u.MessageBox.confirm("是否完成所有操作并提交数据?提交后不能操作此单据").then(function(o){e.isSubmit=!0,e.submitBtnText="提交中...";var s=e.allPhotoLists.photoList,i={base64RcordId:e.allPhotoLists.rcordId,cleanTypeId:e.allPhotoLists.cleanTypeId,name:e.allPhotoLists.name,reason:e.allPhotoLists.reason,planOutDate:e.allPhotoLists.startTimeText,planReturnDate:e.allPhotoLists.endTimeText,submit:t,imgs:s.map(function(t){return{itemId:t.itemId,name:t.name,data:t.data,isNewFoto:t.isNewFoto}})};console.log(i,"submit"),Object(v.a)(i).then(function(t){200===t.status&&(Object(u.Toast)({message:"提交成功",duration:1500}),setTimeout(function(){e.$router.push("/clearRecord")},2e3)),e.isSubmit=!1,e.submitBtnText="提交"}).catch(function(t){Object(u.Toast)("提交失败"),e.isSubmit=!1,e.submitBtnText="提交"})});else{var o=this.allPhotoLists.photoList,s={base64RcordId:this.allPhotoLists.rcordId,cleanTypeId:this.allPhotoLists.cleanTypeId,name:this.allPhotoLists.name,reason:this.allPhotoLists.reason,planOutDate:this.allPhotoLists.startTimeText,planReturnDate:this.allPhotoLists.endTimeText,submit:t,imgs:o.map(function(t){return{itemId:t.itemId,name:t.name,data:t.data}})};console.log(s,"store"),Object(v.a)(s).then(function(t){200===t.status&&(Object(u.Toast)({message:"暂存成功",duration:1500}),setTimeout(function(){e.$router.push("/clearRecord")},2e3))}).catch(function(t){Object(u.Toast)("暂存失败")})}}}},I={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",staticStyle:{"max-width":"100%","box-sizing":"border-box"}},[s("myHeader",{attrs:{isBack:!0,backPath:"/clearRecord",title:"返场消毒记录详情"}}),t._v(" "),s("div",{staticClass:"mt4 list-block"},[s("mt-cell",[s("div",{staticClass:"info",attrs:{slot:"title"},slot:"title"},[t._v("出场信息")])]),t._v(" "),s("div",{staticClass:"info"},[s("mt-cell",[s("span",{staticClass:"grey f14",attrs:{slot:"title"},slot:"title"},[t._v("姓名:")]),t._v(" "),s("span",{staticClass:"f14"},[t._v(t._s(t.allPhotoLists.name))])]),t._v(" "),s("mt-cell",{staticClass:"border-dash"},[s("span",{staticClass:"grey",attrs:{slot:"title"},slot:"title"},[t._v("计划出场时间：")]),t._v(" "),s("span",{staticClass:"color-text"},[t._v("\n          "+t._s(t.allPhotoLists.startTimeText)+"\n        ")]),t._v(" "),s("span",{staticClass:"time"})]),t._v(" "),s("mt-cell",{staticClass:"border-none"},[s("span",{staticClass:"grey",attrs:{slot:"title"},slot:"title"},[t._v("计划返场时间：")]),t._v(" "),s("span",{staticClass:"color-text"},[t._v("\n          "+t._s(t.allPhotoLists.endTimeText)+"\n        ")]),t._v(" "),s("span",{staticClass:"time"})])],1),t._v(" "),s("div",{staticClass:"divide"}),t._v(" "),s("div",{staticClass:"info"},[s("mt-cell",{attrs:{title:"出场事由"}}),t._v(" "),s("div",{staticClass:"reason-body"},[s("div",{staticClass:"reason"},[t._v(t._s(t.allPhotoLists.reason))])])],1),t._v(" "),29!=t.allPhotoLists.approveStatusIndex?s("div",[s("div",{staticClass:"divide"}),t._v(" "),s("mt-cell",[s("span",{staticClass:"f16-black",attrs:{slot:"title"},slot:"title"},[t._v("审批管理员")]),t._v(" "),s("span",{staticClass:"f14-black"},[t._v(t._s(t.allPhotoLists.approveAdminName))])]),t._v(" "),s("mt-cell",[s("span",{staticClass:"f14 grey",attrs:{slot:"title"},slot:"title"},[t._v("审批结果")]),t._v(" "),1==t.allPhotoLists.approveStatusIndex?s("span",{staticClass:"blue f14"},[t._v("同意")]):t._e(),t._v(" "),2==t.allPhotoLists.approveStatusIndex?s("span",{staticClass:"red f14"},[t._v("不同意")]):t._e()]),t._v(" "),s("div",{staticClass:"divide"}),t._v(" "),t._l(t.allPhotoLists.serviceSite,function(e,i){return s("div",{key:i,staticClass:"photoList-item"},[s("div",{staticClass:"header",style:{backgroundColor:t.colorList[i%3]},on:{click:function(e){return t.togglePhotoItem(i)}}},[s("div",{staticClass:"left"},[s("span",{staticClass:"circle"},[s("i",{style:{color:t.colorList[i%3]}},[t._v(t._s(i+1))])]),t._v("\n            "+t._s(e.name)+"\n          ")]),t._v(" "),s("span",[s("img",{class:e.show?"":"rotate",attrs:{src:o("+ciL"),alt:""}})])]),t._v(" "),e.show?s("div",{staticClass:"takePhotoList"},t._l(e.itemInfoList,function(t,e){return s("take-photo-item",{key:e,staticClass:"takePhoto-item",attrs:{itemInfo:t,currentIndex:e}})}),1):t._e()])})],2):t._e(),t._v(" "),1==t.allPhotoLists.billStatusIndex&&1==t.allPhotoLists.approveStatusIndex?s("div",{staticClass:"btn-list"},[s("mt-button",{attrs:{type:"default"},on:{click:function(e){return t.submit(!1)}}},[t._v("暂存")]),t._v(" "),s("mt-button",{attrs:{type:"primary",disabled:t.isSubmit},on:{click:function(e){return t.submit(!0)}}},[t._v(t._s(t.submitBtnText))])],1):t._e()],1)],1)},staticRenderFns:[]};var P=o("C7Lr")(L,I,!1,function(t){o("tTGq")},"data-v-12816c4a",null);e.default=P.exports},Y8gv:function(t,e){},tTGq:function(t,e){}});
//# sourceMappingURL=9.4145c439906fc2848b80.js.map